<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<title>SQLite Query Language: CREATE TRIGGER</title>
<style type="text/css">
body {
    margin: auto;
    font-family: Verdana, sans-serif;
    padding: 8px 1%;
}

a { color: #044a64 }
a:visited { color: #734559 }

.logo { position:absolute; margin:3px; }
.tagline {
  float:right;
  text-align:right;
  font-style:italic;
  width:300px;
  margin:12px;
  margin-top:58px;
}

.menubar {
  clear: both;
  border-radius: 8px;
  background: #044a64;
  padding: 0px;
  margin: 0px;
  cell-spacing: 0px;
}    
.toolbar {
  text-align: center;
  line-height: 1.6em;
  margin: 0;
  padding: 0px 8px;
}
.toolbar a { color: white; text-decoration: none; padding: 6px 12px; }
.toolbar a:visited { color: white; }
.toolbar a:hover { color: #044a64; background: white; }

.content    { margin: 5%; }
.content dt { font-weight:bold; }
.content dd { margin-bottom: 25px; margin-left:20%; }
.content ul { padding:0px; padding-left: 15px; margin:0px; }

/* Things for "fancyformat" documents start here. */
.fancy img+p {font-style:italic}
.fancy .codeblock i { color: darkblue; }
.fancy h1,.fancy h2,.fancy h3,.fancy h4 {font-weight:normal;color:#044a64}
.fancy h2 { margin-left: 10px }
.fancy h3 { margin-left: 20px }
.fancy h4 { margin-left: 30px }
.fancy th {white-space:nowrap;text-align:left;border-bottom:solid 1px #444}
.fancy th, .fancy td {padding: 0.2em 1ex; vertical-align:top}
.fancy #toc a        { color: darkblue ; text-decoration: none }
.fancy .todo         { color: #AA3333 ; font-style : italic }
.fancy .todo:before  { content: 'TODO:' }
.fancy p.todo        { border: solid #AA3333 1px; padding: 1ex }
.fancy img { display:block; }
.fancy :link:hover, .fancy :visited:hover { background: wheat }
.fancy p,.fancy ul,.fancy ol { margin: 1em 5ex }
.fancy li p { margin: 1em 0 }
/* End of "fancyformat" specific rules. */

</style>
  
</head>
<body>
<div><!-- container div to satisfy validator -->

<a href="index.html">
<img class="logo" src="images/sqlite370_banner.gif" alt="SQLite Logo"
 border="0"></a>
<div><!-- IE hack to prevent disappearing logo--></div>
<div class="tagline">Small. Fast. Reliable.<br>Choose any three.</div>

<table width=100% class="menubar"><tr>
  <td width=100%>
  <div class="toolbar">
    <a href="about.html">关于</a>
    <a href="sitemap.html">网站地图</a>
    <a href="docs.html">文档</a>
    <a href="download.html">下载</a>
    <a href="copyright.html">许可</a>
    <a href="news.html">新闻</a>
    <a href="support.html">支持</a>
  </div>
<script>
  gMsg = "搜索SQLite文档..."
  function entersearch() {
    var q = document.getElementById("q");
    if( q.value == gMsg ) { q.value = "" }
    q.style.color = "black"
    q.style.fontStyle = "normal"
  }
  function leavesearch() {
    var q = document.getElementById("q");
    if( q.value == "" ) { 
      q.value = gMsg
      q.style.color = "#044a64"
      q.style.fontStyle = "italic"
    }
  }
  function hideorshow(btn,obj){
    var x = document.getElementById(obj);
    var b = document.getElementById(btn);
    if( x.style.display!='none' ){
      x.style.display = 'none';
      b.innerHTML='显示';
    }else{
      x.style.display = '';
      b.innerHTML='隐藏';
    }
    return false;
  }
</script>
<td>
    <div style="padding:0 1em 0px 0;white-space:nowrap">
    <form name=f method="GET" action="http://www.sqlite.org/search">
      <input id=q name=q type=text
       onfocus="entersearch()" onblur="leavesearch()" style="width:24ex;padding:1px 1ex; border:solid white 1px; font-size:0.9em ; font-style:italic;color:#044a64;" value="搜索SQLite文档...">
      <input type=submit value="Go" style="border:solid white 1px;background-color:#044a64;color:white;font-size:0.9em;padding:0 1ex">
    </form>
    </div>
  </table>

<div class=startsearch></div>
  
<h1 align="center">SQLite里的SQL<br/>SQL As Understood By SQLite</h1><p><a href="lang.html">[Top]</a></p><h2>CREATE TRIGGER</h2><p><b><a href="syntaxdiagrams.html#create-trigger-stmt">create-trigger-stmt:</a></b>
<button id='x923' onclick='hideorshow("x923","x924")'>隐藏</button></p>
 <blockquote id='x924'>
 <img alt="syntax diagram create-trigger-stmt" src="images/syntax/create-trigger-stmt.gif" />
<p><b><a href="syntaxdiagrams.html#delete-stmt">delete-stmt:</a></b>
<button id='x925' onclick='hideorshow("x925","x926")'>显示</button></p>
 <blockquote id='x926' style='display:none;'>
 <img alt="syntax diagram delete-stmt" src="images/syntax/delete-stmt.gif" />
<p><b><a href="syntaxdiagrams.html#qualified-table-name">qualified-table-name:</a></b>
<button id='x927' onclick='hideorshow("x927","x928")'>显示</button></p>
 <blockquote id='x928' style='display:none;'>
 <img alt="syntax diagram qualified-table-name" src="images/syntax/qualified-table-name.gif" />
</blockquote>
<p><b><a href="syntaxdiagrams.html#with-clause">with-clause:</a></b>
<button id='x929' onclick='hideorshow("x929","x930")'>显示</button></p>
 <blockquote id='x930' style='display:none;'>
 <img alt="syntax diagram with-clause" src="images/syntax/with-clause.gif" />
<p><b><a href="syntaxdiagrams.html#cte-table-name">cte-table-name:</a></b>
<button id='x931' onclick='hideorshow("x931","x932")'>显示</button></p>
 <blockquote id='x932' style='display:none;'>
 <img alt="syntax diagram cte-table-name" src="images/syntax/cte-table-name.gif" />
</blockquote>
</blockquote>
</blockquote>
<p><b><a href="syntaxdiagrams.html#expr">expr:</a></b>
<button id='x933' onclick='hideorshow("x933","x934")'>显示</button></p>
 <blockquote id='x934' style='display:none;'>
 <img alt="syntax diagram expr" src="images/syntax/expr.gif" />
<p><b><a href="syntaxdiagrams.html#literal-value">literal-value:</a></b>
<button id='x935' onclick='hideorshow("x935","x936")'>显示</button></p>
 <blockquote id='x936' style='display:none;'>
 <img alt="syntax diagram literal-value" src="images/syntax/literal-value.gif" />
</blockquote>
<p><b><a href="syntaxdiagrams.html#raise-function">raise-function:</a></b>
<button id='x937' onclick='hideorshow("x937","x938")'>显示</button></p>
 <blockquote id='x938' style='display:none;'>
 <img alt="syntax diagram raise-function" src="images/syntax/raise-function.gif" />
</blockquote>
<p><b><a href="syntaxdiagrams.html#type-name">type-name:</a></b>
<button id='x939' onclick='hideorshow("x939","x940")'>显示</button></p>
 <blockquote id='x940' style='display:none;'>
 <img alt="syntax diagram type-name" src="images/syntax/type-name.gif" />
<p><b><a href="syntaxdiagrams.html#signed-number">signed-number:</a></b>
<button id='x941' onclick='hideorshow("x941","x942")'>显示</button></p>
 <blockquote id='x942' style='display:none;'>
 <img alt="syntax diagram signed-number" src="images/syntax/signed-number.gif" />
</blockquote>
</blockquote>
</blockquote>
<p><b><a href="syntaxdiagrams.html#insert-stmt">insert-stmt:</a></b>
<button id='x943' onclick='hideorshow("x943","x944")'>显示</button></p>
 <blockquote id='x944' style='display:none;'>
 <img alt="syntax diagram insert-stmt" src="images/syntax/insert-stmt.gif" />
<p><b><a href="syntaxdiagrams.html#with-clause">with-clause:</a></b>
<button id='x945' onclick='hideorshow("x945","x946")'>显示</button></p>
 <blockquote id='x946' style='display:none;'>
 <img alt="syntax diagram with-clause" src="images/syntax/with-clause.gif" />
<p><b><a href="syntaxdiagrams.html#cte-table-name">cte-table-name:</a></b>
<button id='x947' onclick='hideorshow("x947","x948")'>显示</button></p>
 <blockquote id='x948' style='display:none;'>
 <img alt="syntax diagram cte-table-name" src="images/syntax/cte-table-name.gif" />
</blockquote>
</blockquote>
</blockquote>
<p><b><a href="syntaxdiagrams.html#select-stmt">select-stmt:</a></b>
<button id='x949' onclick='hideorshow("x949","x950")'>显示</button></p>
 <blockquote id='x950' style='display:none;'>
 <img alt="syntax diagram select-stmt" src="images/syntax/select-stmt.gif" />
<p><b><a href="syntaxdiagrams.html#common-table-expression">common-table-expression:</a></b>
<button id='x951' onclick='hideorshow("x951","x952")'>显示</button></p>
 <blockquote id='x952' style='display:none;'>
 <img alt="syntax diagram common-table-expression" src="images/syntax/common-table-expression.gif" />
</blockquote>
<p><b><a href="syntaxdiagrams.html#compound-operator">compound-operator:</a></b>
<button id='x953' onclick='hideorshow("x953","x954")'>显示</button></p>
 <blockquote id='x954' style='display:none;'>
 <img alt="syntax diagram compound-operator" src="images/syntax/compound-operator.gif" />
</blockquote>
<p><b><a href="syntaxdiagrams.html#join-clause">join-clause:</a></b>
<button id='x955' onclick='hideorshow("x955","x956")'>显示</button></p>
 <blockquote id='x956' style='display:none;'>
 <img alt="syntax diagram join-clause" src="images/syntax/join-clause.gif" />
<p><b><a href="syntaxdiagrams.html#join-constraint">join-constraint:</a></b>
<button id='x957' onclick='hideorshow("x957","x958")'>显示</button></p>
 <blockquote id='x958' style='display:none;'>
 <img alt="syntax diagram join-constraint" src="images/syntax/join-constraint.gif" />
</blockquote>
<p><b><a href="syntaxdiagrams.html#join-operator">join-operator:</a></b>
<button id='x959' onclick='hideorshow("x959","x960")'>显示</button></p>
 <blockquote id='x960' style='display:none;'>
 <img alt="syntax diagram join-operator" src="images/syntax/join-operator.gif" />
</blockquote>
</blockquote>
<p><b><a href="syntaxdiagrams.html#ordering-term">ordering-term:</a></b>
<button id='x961' onclick='hideorshow("x961","x962")'>显示</button></p>
 <blockquote id='x962' style='display:none;'>
 <img alt="syntax diagram ordering-term" src="images/syntax/ordering-term.gif" />
</blockquote>
<p><b><a href="syntaxdiagrams.html#result-column">result-column:</a></b>
<button id='x963' onclick='hideorshow("x963","x964")'>显示</button></p>
 <blockquote id='x964' style='display:none;'>
 <img alt="syntax diagram result-column" src="images/syntax/result-column.gif" />
</blockquote>
<p><b><a href="syntaxdiagrams.html#table-or-subquery">table-or-subquery:</a></b>
<button id='x965' onclick='hideorshow("x965","x966")'>显示</button></p>
 <blockquote id='x966' style='display:none;'>
 <img alt="syntax diagram table-or-subquery" src="images/syntax/table-or-subquery.gif" />
</blockquote>
</blockquote>
<p><b><a href="syntaxdiagrams.html#update-stmt">update-stmt:</a></b>
<button id='x967' onclick='hideorshow("x967","x968")'>显示</button></p>
 <blockquote id='x968' style='display:none;'>
 <img alt="syntax diagram update-stmt" src="images/syntax/update-stmt.gif" />
<p><b><a href="syntaxdiagrams.html#qualified-table-name">qualified-table-name:</a></b>
<button id='x969' onclick='hideorshow("x969","x970")'>显示</button></p>
 <blockquote id='x970' style='display:none;'>
 <img alt="syntax diagram qualified-table-name" src="images/syntax/qualified-table-name.gif" />
</blockquote>
<p><b><a href="syntaxdiagrams.html#with-clause">with-clause:</a></b>
<button id='x971' onclick='hideorshow("x971","x972")'>显示</button></p>
 <blockquote id='x972' style='display:none;'>
 <img alt="syntax diagram with-clause" src="images/syntax/with-clause.gif" />
<p><b><a href="syntaxdiagrams.html#cte-table-name">cte-table-name:</a></b>
<button id='x973' onclick='hideorshow("x973","x974")'>显示</button></p>
 <blockquote id='x974' style='display:none;'>
 <img alt="syntax diagram cte-table-name" src="images/syntax/cte-table-name.gif" />
</blockquote>
</blockquote>
</blockquote>
</blockquote>


<p>CREATE TRIGGER语句用于在数据库结构中添加一个触发器。触发器可以使数据库在指定的数据库事件发生时自动执行一些数据库操作。
<br />The CREATE TRIGGER statement is used to add triggers to the 
database schema. Triggers are database operations 
that are automatically performed when a specified database event
occurs.  </p>

<p>触发器可以在某个数据库表上发生<a href="lang_delete.html">DELETE</a>、 <a href="lang_insert.html">INSERT</a>或
<a href="lang_update.html">UPDATE</a>事件时触发，也可以在一个表上的一个或多个列上发生<a href="lang_update.html">UPDATE</a>事件时触发。
<br />A trigger may be specified to fire whenever a <a href="lang_delete.html">DELETE</a>, <a href="lang_insert.html">INSERT</a>,
or <a href="lang_update.html">UPDATE</a> of a
particular database table occurs, or whenever an <a href="lang_update.html">UPDATE</a> occurs on
on one or more specified columns of a table.</p>

<p>目前SQLite只支持FOR EACH ROW 触发器，不吃食FOR EACH STATEMENT触发器。
因此，不需要总是明确指定FOR EACH ROW。FOR EACH ROW是指，当有语句触发触发器时，数据库中每一行记录的插入、更新和删除都会执行（依赖于WHEN子句）触发器中指定的SQL语句。
<br />At this time SQLite supports only FOR EACH ROW triggers, not FOR EACH
STATEMENT triggers. Hence explicitly specifying FOR EACH ROW is optional.
FOR EACH ROW implies that the SQL statements specified in the trigger
may be executed (depending on the WHEN clause) for each database row being
inserted, updated or deleted by the statement causing the trigger to fire.</p>

<p>WHEN子句和触发器动作都可以可以通过"NEW.<i>column-name</i>" 和 "OLD.<i>column-name</i>"来引用被插入、删除或修改的数据行中的元素，其中<i>column-name</i>是触发器所关联的表的列名。
在不同的触发器事件中OLD和NEW引用是否有效依赖于下表：
<br />Both the WHEN clause and the trigger actions may access elements of 
the row being inserted, deleted or updated using references of the form 
"NEW.<i>column-name</i>" and "OLD.<i>column-name</i>", where
<i>column-name</i> is the name of a column from the table that the trigger
is associated with. OLD and NEW references may only be used in triggers on
events for which they are relevant, as follows:</p>

<table border=0 cellpadding=10>
<tr>
<td valign="top" align="right" width=120><i>INSERT</i></td>
<td valign="top">NEW引用有效
<br />NEW references are valid</td>
</tr>
<tr>
<td valign="top" align="right" width=120><i>UPDATE</i></td>
<td valign="top">NEW和OLD引用有效
<br />NEW and OLD references are valid</td>
</tr>
<tr>
<td valign="top" align="right" width=120><i>DELETE</i></td>
<td valign="top">OLD引用有效
<br />OLD references are valid</td>
</tr>
</table>
</p>

<p>如果提供了WHEN子句，那么只有WHEN子句为true记录行才会执行指定的语句。如果没有提供WHEN子句，那么所有的行都会执行SQL语句。
<br />If a WHEN clause is supplied, the SQL statements specified
are only executed for rows for which the WHEN
clause is true. If no WHEN clause is supplied, the SQL statements
are executed for all rows.</p>

<p>BEFORE和AFTER关键词用于决定相关行上触发器动作与插入、修改、移除执行顺序的关系。
<br />The BEFORE or AFTER keyword determines when the trigger actions
will be executed relative to the insertion, modification or removal of the
associated row.</p>

<p>在触发器中的<a href="lang_update.html">UPDATE</a> 和 <a href="lang_insert.html">INSERT</a>可以指定一个<a href="lang_conflict.html">ON CONFLICT</a>子句。但是，如果触发触发器的语句也指定了一个<a href="lang_conflict.html">ON CONFLICT</a>子句，那么会用外层的冲突处理策略替换。
<br />An <a href="lang_conflict.html">ON CONFLICT</a> clause may be specified as part of an <a href="lang_update.html">UPDATE</a> or <a href="lang_insert.html">INSERT</a>
action within the body of the trigger.
However if an <a href="lang_conflict.html">ON CONFLICT</a> clause is specified as part of 
the statement causing the trigger to fire, then conflict handling
policy of the outer statement is used instead.</p>

<p>当触发器使用<i>table-name</i>依附的表被<a href="lang_droptable.html">删除</a>了，那么依附在这个表上的触发器也都会被自动<a href="lang_droptrigger.html">删除</a>。但是，如果触发器行为中引用的其它表被<a href="lang_droptable.html">删除</a> 或 <a href="lang_altertable.html">修改</a>了，触发器是不会被删除的。
<br />Triggers are automatically <a href="lang_droptrigger.html">dropped</a>
when the table that they are 
associated with (the <i>table-name</i> table) is 
<a href="lang_droptable.html">dropped</a>.  However if the trigger actions reference
other tables, the trigger is not dropped or modified if those other
tables are <a href="lang_droptable.html">dropped</a> or <a href="lang_altertable.html">modified</a>.</p>

<p>触发器使用<a href="lang_droptrigger.html">DROP TRIGGER</a>语句来移除。
<br />Triggers are removed using the <a href="lang_droptrigger.html">DROP TRIGGER</a> statement.</p>

<h3>触发器中使用UPDATE、 DELETE和 INSERT语句的语法限制
<br />Syntax Restrictions On UPDATE, DELETE, and INSERT Statements Within
    Triggers</h3>

<p>触发器内部的<a href="lang_update.html">UPDATE</a>、 <a href="lang_delete.html">DELETE</a> 和 <a href="lang_insert.html">INSERT</a>语句并不支持<a href="lang_update.html">UPDATE</a>、 <a href="lang_delete.html">DELETE</a> 和 <a href="lang_insert.html">INSERT</a>的完整语法，需要遵守下列限制：
<br />The <a href="lang_update.html">UPDATE</a>, <a href="lang_delete.html">DELETE</a>, and <a href="lang_insert.html">INSERT</a>
statements within triggers do not support
the full syntax for <a href="lang_update.html">UPDATE</a>, <a href="lang_delete.html">DELETE</a>, and <a href="lang_insert.html">INSERT</a> statements.  The following
restrictions apply:</p>

<ul>
<li><p>
  <a href="lang_update.html">UPDATE</a>、 <a href="lang_delete.html">DELETE</a> 和 <a href="lang_insert.html">INSERT</a>语句中需要修改的表明必须是无限定的表明。换句话说，在指定表的时候必须使用"<i>tablename</i>"而不能使用"<i>database</i><b>.</b><i>tablename</i>"。被修改的表必须和触发器依附的表或视图在一个数据库中。
<br />The name of the table to be modified in an <a href="lang_update.html">UPDATE</a>, <a href="lang_delete.html">DELETE</a>, or <a href="lang_insert.html">INSERT</a>
  statement must be an unqualified table name.  In other words, one must
  use just "<i>tablename</i>" not "<i>database</i><b>.</b><i>tablename</i>"
  when specifying the table.  The table to be modified must exist in the
  same database as the table or view to which the trigger is attached.
  </p></li>

<li><p>
  不支持<a href="lang_insert.html">INSERT</a>语句中的"INSERT INTO <i>table</i> DEFAULT VALUES"格式。
<br />The "INSERT INTO <i>table</i> DEFAULT VALUES" form of the <a href="lang_insert.html">INSERT</a> statement
  is not supported.
  </p></li>

<li><p>
  不支持<a href="lang_update.html">UPDATE</a> 和
  <a href="lang_delete.html">DELETE</a>语句中的INDEXED BY和NOT INDEXED子句。
<br />The INDEXED BY and NOT INDEXED clauses are not supported for <a href="lang_update.html">UPDATE</a> and
  <a href="lang_delete.html">DELETE</a> statements.
  </p></li>

<li><p>
  不支持<a href="lang_update.html">UPDATE</a> 和 <a href="lang_delete.html">DELETE</a>语句中的ORDER BY和LIMIT子句。<a href="lang_update.html">UPDATE</a> 和 <a href="lang_delete.html">DELETE</a>中的ORDER BY和LIMIT通常在任何上下文中都是不能使用的，不过在使用了<a href="compile.html#enable_update_delete_limit">SQLITE_ENABLE_UPDATE_DELETE_LIMIT</a>编译选项后，可以再顶级的语句中使用。但是编译选项只允许顶级<a href="lang_update.html">UPDATE</a> 和 <a href="lang_delete.html">DELETE</a>使用，而不允许触发器内的<a href="lang_update.html">UPDATE</a> 和 <a href="lang_delete.html">DELETE</a>使用。
<br />The ORDER BY and LIMIT clauses on <a href="lang_update.html">UPDATE</a> and <a href="lang_delete.html">DELETE</a> statements are not
  supported.  ORDER BY and LIMIT are not normally supported for <a href="lang_update.html">UPDATE</a> or
  <a href="lang_delete.html">DELETE</a> in any context but can be enabled for top-level statements
  using the <a href="compile.html#enable_update_delete_limit">SQLITE_ENABLE_UPDATE_DELETE_LIMIT</a> compile-time option.  However,
  that compile-time option only applies to top-level <a href="lang_update.html">UPDATE</a> and <a href="lang_delete.html">DELETE</a>
  statements, not <a href="lang_update.html">UPDATE</a> and <a href="lang_delete.html">DELETE</a> statements within triggers.
  </p></li>
</ul>

<a name="instead_of_trigger"></a>

<h3>INSTEAD OF触发器
<br />INSTEAD OF trigger</h3>

<p>通过在CREATE TRIGGER语句中指定INSTEAD OF可以在<a href="lang_createview.html">视图</a>上创建一个触发器，就像普通表格一样。
如果在一个视图上定义多个ON INSERT、ON DELETE或者ON UPDATE触发器，那么在视图上分别执行INSERT、 DELETE或UPDATE语句是不会导致错误的。事实上，在视图上执行一个INSERT、DELETE或者UPDATE会触发相关联的触发器，但是视图下的实际表格是不会被修改的（除非在触发器程序中特别指定）。
<br />Triggers may be created on <a href="lang_createview.html">views</a>, as well as ordinary tables, by
specifying INSTEAD OF in the CREATE TRIGGER statement. 
If one or more ON INSERT, ON DELETE
or ON UPDATE triggers are defined on a view, then it is not an
error to execute an INSERT, DELETE or UPDATE statement on the view, 
respectively.  Instead,
executing an INSERT, DELETE or UPDATE on the view causes the associated
triggers to fire. The real tables underlying the view are not modified
(except possibly explicitly, by a trigger program).</p>

<p>注意，<a href="c3ref/changes.html">sqlite3_changes()</a>和<a href="c3ref/total_changes.html">sqlite3_total_changes()</a>接口是不会统计INSERT OF触发器事件的，不过<a href="pragma.html#pragma_count_changes">count_changes 指令</a>会统计INSTEAD OF触发器事件。
<br />Note that the <a href="c3ref/changes.html">sqlite3_changes()</a> and <a href="c3ref/total_changes.html">sqlite3_total_changes()</a> interfaces
do not count INSTEAD OF trigger firings, but the
<a href="pragma.html#pragma_count_changes">count_changes pragma</a> does count INSTEAD OF trigger firing.</p>

<h3>举例
<br />Examples</h3>

<p>假设，顾客记录存储在"customers"表中，订单记录存储在"orders"表中，下面的触发器可以确保当顾客修改了他们的地址时所有关联的订单可以更新。
<br />Assuming that customer records are stored in the "customers" table, and
that order records are stored in the "orders" table, the following trigger
ensures that all associated orders are redirected when a customer changes
his or her address:</p>

<blockquote><pre>
CREATE TRIGGER update_customer_address UPDATE OF address ON customers 
  BEGIN
    UPDATE orders SET address = new.address WHERE customer_name = old.name;
  END;
</pre></blockquote>

<p>当加入了这个触发器后，执行语句：
<br />With this trigger installed, executing the statement:</p>

<blockquote><pre>
UPDATE customers SET address = '1 Main St.' WHERE name = 'Jack Jones';
</pre></blockquote>

<p>会触发下面的语句自动执行：
<br />causes the following to be automatically executed:</p>

<blockquote><pre>
UPDATE orders SET address = '1 Main St.' WHERE customer_name = 'Jack Jones';
</pre></blockquote>

<a name="undef_before"></a>

<h3>使用BEFORE触发器的注意事项
<br />Cautions On The Use Of BEFORE triggers</h3>

<p>如果一个BEFORE UPDATE 或 BEFORE DELETE触发器修改或删除那个即将要被更新或删除的记录行，那么后面的更新或删除操作的结果是未知的。而且，如果一个BEFORE触发器修改或删除一行，那么这些行上的其他一些AFTER触发器是否会真正执行是未知的。
<br />If a BEFORE UPDATE or BEFORE DELETE trigger modifies or deletes a row
that was to have been updated or deleted, then the result of the subsequent
update or delete operation is undefined.  Furthermore, if a BEFORE trigger
modifies or deletes a row, then it is undefined whether or not AFTER triggers
that would have otherwise run on those rows will in fact run.
</p>

<p>如果rowid没有明确指定为一个整数，那么在BEFORE INSERT触发器中NEW.rowid的值是未知的
<br />The value of NEW.rowid is undefined in a BEFORE INSERT trigger in which
the rowid is not explicitly set to an integer.</p>

<p>正是由于上面的情况，程序员们相比BEFORE触发器而言更喜欢AFTER触发器。
<br />Because of the behaviors described above, programmers are encouraged to
prefer AFTER triggers over BEFORE triggers.</p>

<h3>RAISE()函数
<br />The RAISE() function</h3>

<p>在触发器程序中可以按照下面的语法使用一个特殊的SQL函数RAISE()。
<br />A special SQL function RAISE() may be used within a trigger-program,
with the following syntax</p> 

<p><b><a href="syntaxdiagrams.html#raise-function">raise-function:</a></b></p><blockquote>
 <img alt="syntax diagram raise-function" src="images/syntax/raise-function.gif"></img>
 </blockquote>


<p>如果在触发器程序执行中调用了RAISE(ROLLBACK,...)、 RAISE(ABORT,...) 或 RAISE(FAIL,...)之一，那么指定的<a href="lang_conflict.html">ON CONFLICT</a>处理逻辑会执行而当前查询会终止，并且会返回给应用一个<a href="c3ref/c_abort.html">SQLITE_CONSTRAINT</a>错误码和一个指定的错误信息。
<br />When one of RAISE(ROLLBACK,...), RAISE(ABORT,...) or RAISE(FAIL,...)
is called during trigger-program
execution, the specified <a href="lang_conflict.html">ON CONFLICT</a> processing is performed
the current query terminates.
An error code of <a href="c3ref/c_abort.html">SQLITE_CONSTRAINT</a> is returned to the application,
along with the specified error message.</p>

<p>如果调用了RAISE(IGNORE)，那么触发器程序中剩余的部分、触发触发器的语句和其他后续的应当执行的触发器都会被抛弃。数据库修改不会回滚。如果触发触发器的语句就在这个触发器程序中，那么这个触发器程序会在下一步开始处恢复执行。
<br />When RAISE(IGNORE) is called, the remainder of the current trigger program,
the statement that caused the trigger program to execute and any subsequent
trigger programs that would have been executed are abandoned. No database
changes are rolled back.  If the statement that caused the trigger program
to execute is itself part of a trigger program, then that trigger program
resumes execution at the beginning of the next step.
</p>

<a name="temptrig"></a>

<h3>非临时表上的临时触发器
<br />TEMP Triggers on Non-TEMP Tables</h3>

<p>触发器通常与CREATE TRIGGER语句中"ON"关键词后面指定的表名在同一个数据库中。不过，可以在另一个数据库上为该表创建一个临时触发器。这种触发器只有当定义这个触发器的程序在目标表格上产生了修改才会触发。其他修改数据库的应用程序则看不到这个临时触发器，也就无法运行这个触发器。
<br />A trigger normally exists in the same database as the table named
after the "ON" keyword in the CREATE TRIGGER statement.  Except, it is
possible to create a TEMP TRIGGER on a table in another database.  
Such a trigger will only fire when changes
are made to the target table by the application that defined the trigger.
Other applications that modify the database will not be able to see the
TEMP trigger and hence cannot run the trigger.</p>

<p>当为一个非临时表定义临时触发器时，指定存储这个非临时表的数据库是非常重要的。例如，在下面的语句中，用"main.tab1"替换"tabl1"是非常重要的。
<br />When defining a TEMP trigger on a non-TEMP table, it is important to
specify the database holding the non-TEMP table.  For example,
in the following statement, it is important to say "main.tab1" instead
of just "tab1":</p>

<blockquote><pre>
CREATE TEMP TRIGGER ex1 AFTER INSERT ON <b>main.</b>tab1 BEGIN ...
</pre></blockquote>

<p>如果未能给目标表格指定数据库名，那么当数据库结构发生变化时，临时触发器可能会重新附加到其他数据库上同名的表上。
<br />Failure to specify the database name on the target table could result
in the TEMP trigger being reattached to a table with the same name in
another database whenever any schema change occurs.</p>


