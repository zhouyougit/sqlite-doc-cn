<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<title>SQLite Query Language: UPDATE</title>
<style type="text/css">
body {
    margin: auto;
    font-family: Verdana, sans-serif;
    padding: 8px 1%;
}

a { color: #044a64 }
a:visited { color: #734559 }

.logo { position:absolute; margin:3px; }
.tagline {
  float:right;
  text-align:right;
  font-style:italic;
  width:300px;
  margin:12px;
  margin-top:58px;
}

.menubar {
  clear: both;
  border-radius: 8px;
  background: #044a64;
  padding: 0px;
  margin: 0px;
  cell-spacing: 0px;
}    
.toolbar {
  text-align: center;
  line-height: 1.6em;
  margin: 0;
  padding: 0px 8px;
}
.toolbar a { color: white; text-decoration: none; padding: 6px 12px; }
.toolbar a:visited { color: white; }
.toolbar a:hover { color: #044a64; background: white; }

.content    { margin: 5%; }
.content dt { font-weight:bold; }
.content dd { margin-bottom: 25px; margin-left:20%; }
.content ul { padding:0px; padding-left: 15px; margin:0px; }

/* Things for "fancyformat" documents start here. */
.fancy img+p {font-style:italic}
.fancy .codeblock i { color: darkblue; }
.fancy h1,.fancy h2,.fancy h3,.fancy h4 {font-weight:normal;color:#044a64}
.fancy h2 { margin-left: 10px }
.fancy h3 { margin-left: 20px }
.fancy h4 { margin-left: 30px }
.fancy th {white-space:nowrap;text-align:left;border-bottom:solid 1px #444}
.fancy th, .fancy td {padding: 0.2em 1ex; vertical-align:top}
.fancy #toc a        { color: darkblue ; text-decoration: none }
.fancy .todo         { color: #AA3333 ; font-style : italic }
.fancy .todo:before  { content: 'TODO:' }
.fancy p.todo        { border: solid #AA3333 1px; padding: 1ex }
.fancy img { display:block; }
.fancy :link:hover, .fancy :visited:hover { background: wheat }
.fancy p,.fancy ul,.fancy ol { margin: 1em 5ex }
.fancy li p { margin: 1em 0 }
/* End of "fancyformat" specific rules. */

</style>
  
</head>
<body>
<div><!-- container div to satisfy validator -->

<a href="index.html">
<img class="logo" src="images/sqlite370_banner.gif" alt="SQLite Logo"
 border="0"></a>
<div><!-- IE hack to prevent disappearing logo--></div>
<div class="tagline">Small. Fast. Reliable.<br>Choose any three.</div>

<table width=100% class="menubar"><tr>
  <td width=100%>
  <div class="toolbar">
    <a href="about.html">关于</a>
    <a href="sitemap.html">网站地图</a>
    <a href="docs.html">文档</a>
    <a href="download.html">下载</a>
    <a href="copyright.html">许可</a>
    <a href="news.html">新闻</a>
    <a href="support.html">支持</a>
  </div>
<script>
  gMsg = "搜索SQLite文档..."
  function entersearch() {
    var q = document.getElementById("q");
    if( q.value == gMsg ) { q.value = "" }
    q.style.color = "black"
    q.style.fontStyle = "normal"
  }
  function leavesearch() {
    var q = document.getElementById("q");
    if( q.value == "" ) { 
      q.value = gMsg
      q.style.color = "#044a64"
      q.style.fontStyle = "italic"
    }
  }
  function hideorshow(btn,obj){
    var x = document.getElementById(obj);
    var b = document.getElementById(btn);
    if( x.style.display!='none' ){
      x.style.display = 'none';
      b.innerHTML='显示';
    }else{
      x.style.display = '';
      b.innerHTML='隐藏';
    }
    return false;
  }
</script>
<td>
    <div style="padding:0 1em 0px 0;white-space:nowrap">
    <form name=f method="GET" action="http://www.sqlite.org/search">
      <input id=q name=q type=text
       onfocus="entersearch()" onblur="leavesearch()" style="width:24ex;padding:1px 1ex; border:solid white 1px; font-size:0.9em ; font-style:italic;color:#044a64;" value="搜索SQLite文档...">
      <input type=submit value="Go" style="border:solid white 1px;background-color:#044a64;color:white;font-size:0.9em;padding:0 1ex">
    </form>
    </div>
  </table>

<div class=startsearch></div>
  
<h1 align="center">SQLite里的SQL<br/>SQL As Understood By SQLite</h1><p><a href="lang.html">[Top]</a></p><h2>更新
<br />UPDATE</h2><p><b><a href="syntaxdiagrams.html#update-stmt">update-stmt:</a></b>
<button id='x1377' onclick='hideorshow("x1377","x1378")'>隐藏</button></p>
 <blockquote id='x1378'>
 <img alt="syntax diagram update-stmt" src="images/syntax/update-stmt.gif" />
<p><b><a href="syntaxdiagrams.html#expr">expr:</a></b>
<button id='x1379' onclick='hideorshow("x1379","x1380")'>显示</button></p>
 <blockquote id='x1380' style='display:none;'>
 <img alt="syntax diagram expr" src="images/syntax/expr.gif" />
<p><b><a href="syntaxdiagrams.html#literal-value">literal-value:</a></b>
<button id='x1381' onclick='hideorshow("x1381","x1382")'>显示</button></p>
 <blockquote id='x1382' style='display:none;'>
 <img alt="syntax diagram literal-value" src="images/syntax/literal-value.gif" />
</blockquote>
<p><b><a href="syntaxdiagrams.html#raise-function">raise-function:</a></b>
<button id='x1383' onclick='hideorshow("x1383","x1384")'>显示</button></p>
 <blockquote id='x1384' style='display:none;'>
 <img alt="syntax diagram raise-function" src="images/syntax/raise-function.gif" />
</blockquote>
<p><b><a href="syntaxdiagrams.html#select-stmt">select-stmt:</a></b>
<button id='x1385' onclick='hideorshow("x1385","x1386")'>显示</button></p>
 <blockquote id='x1386' style='display:none;'>
 <img alt="syntax diagram select-stmt" src="images/syntax/select-stmt.gif" />
<p><b><a href="syntaxdiagrams.html#common-table-expression">common-table-expression:</a></b>
<button id='x1387' onclick='hideorshow("x1387","x1388")'>显示</button></p>
 <blockquote id='x1388' style='display:none;'>
 <img alt="syntax diagram common-table-expression" src="images/syntax/common-table-expression.gif" />
</blockquote>
<p><b><a href="syntaxdiagrams.html#compound-operator">compound-operator:</a></b>
<button id='x1389' onclick='hideorshow("x1389","x1390")'>显示</button></p>
 <blockquote id='x1390' style='display:none;'>
 <img alt="syntax diagram compound-operator" src="images/syntax/compound-operator.gif" />
</blockquote>
<p><b><a href="syntaxdiagrams.html#join-clause">join-clause:</a></b>
<button id='x1391' onclick='hideorshow("x1391","x1392")'>显示</button></p>
 <blockquote id='x1392' style='display:none;'>
 <img alt="syntax diagram join-clause" src="images/syntax/join-clause.gif" />
<p><b><a href="syntaxdiagrams.html#join-constraint">join-constraint:</a></b>
<button id='x1393' onclick='hideorshow("x1393","x1394")'>显示</button></p>
 <blockquote id='x1394' style='display:none;'>
 <img alt="syntax diagram join-constraint" src="images/syntax/join-constraint.gif" />
</blockquote>
<p><b><a href="syntaxdiagrams.html#join-operator">join-operator:</a></b>
<button id='x1395' onclick='hideorshow("x1395","x1396")'>显示</button></p>
 <blockquote id='x1396' style='display:none;'>
 <img alt="syntax diagram join-operator" src="images/syntax/join-operator.gif" />
</blockquote>
</blockquote>
<p><b><a href="syntaxdiagrams.html#ordering-term">ordering-term:</a></b>
<button id='x1397' onclick='hideorshow("x1397","x1398")'>显示</button></p>
 <blockquote id='x1398' style='display:none;'>
 <img alt="syntax diagram ordering-term" src="images/syntax/ordering-term.gif" />
</blockquote>
<p><b><a href="syntaxdiagrams.html#result-column">result-column:</a></b>
<button id='x1399' onclick='hideorshow("x1399","x1400")'>显示</button></p>
 <blockquote id='x1400' style='display:none;'>
 <img alt="syntax diagram result-column" src="images/syntax/result-column.gif" />
</blockquote>
<p><b><a href="syntaxdiagrams.html#table-or-subquery">table-or-subquery:</a></b>
<button id='x1401' onclick='hideorshow("x1401","x1402")'>显示</button></p>
 <blockquote id='x1402' style='display:none;'>
 <img alt="syntax diagram table-or-subquery" src="images/syntax/table-or-subquery.gif" />
</blockquote>
</blockquote>
<p><b><a href="syntaxdiagrams.html#type-name">type-name:</a></b>
<button id='x1403' onclick='hideorshow("x1403","x1404")'>显示</button></p>
 <blockquote id='x1404' style='display:none;'>
 <img alt="syntax diagram type-name" src="images/syntax/type-name.gif" />
<p><b><a href="syntaxdiagrams.html#signed-number">signed-number:</a></b>
<button id='x1405' onclick='hideorshow("x1405","x1406")'>显示</button></p>
 <blockquote id='x1406' style='display:none;'>
 <img alt="syntax diagram signed-number" src="images/syntax/signed-number.gif" />
</blockquote>
</blockquote>
</blockquote>
<p><b><a href="syntaxdiagrams.html#qualified-table-name">qualified-table-name:</a></b>
<button id='x1407' onclick='hideorshow("x1407","x1408")'>显示</button></p>
 <blockquote id='x1408' style='display:none;'>
 <img alt="syntax diagram qualified-table-name" src="images/syntax/qualified-table-name.gif" />
</blockquote>
<p><b><a href="syntaxdiagrams.html#with-clause">with-clause:</a></b>
<button id='x1409' onclick='hideorshow("x1409","x1410")'>显示</button></p>
 <blockquote id='x1410' style='display:none;'>
 <img alt="syntax diagram with-clause" src="images/syntax/with-clause.gif" />
<p><b><a href="syntaxdiagrams.html#cte-table-name">cte-table-name:</a></b>
<button id='x1411' onclick='hideorshow("x1411","x1412")'>显示</button></p>
 <blockquote id='x1412' style='display:none;'>
 <img alt="syntax diagram cte-table-name" src="images/syntax/cte-table-name.gif" />
</blockquote>
<p><b><a href="syntaxdiagrams.html#select-stmt">select-stmt:</a></b>
<button id='x1413' onclick='hideorshow("x1413","x1414")'>显示</button></p>
 <blockquote id='x1414' style='display:none;'>
 <img alt="syntax diagram select-stmt" src="images/syntax/select-stmt.gif" />
<p><b><a href="syntaxdiagrams.html#common-table-expression">common-table-expression:</a></b>
<button id='x1415' onclick='hideorshow("x1415","x1416")'>显示</button></p>
 <blockquote id='x1416' style='display:none;'>
 <img alt="syntax diagram common-table-expression" src="images/syntax/common-table-expression.gif" />
</blockquote>
<p><b><a href="syntaxdiagrams.html#compound-operator">compound-operator:</a></b>
<button id='x1417' onclick='hideorshow("x1417","x1418")'>显示</button></p>
 <blockquote id='x1418' style='display:none;'>
 <img alt="syntax diagram compound-operator" src="images/syntax/compound-operator.gif" />
</blockquote>
<p><b><a href="syntaxdiagrams.html#join-clause">join-clause:</a></b>
<button id='x1419' onclick='hideorshow("x1419","x1420")'>显示</button></p>
 <blockquote id='x1420' style='display:none;'>
 <img alt="syntax diagram join-clause" src="images/syntax/join-clause.gif" />
<p><b><a href="syntaxdiagrams.html#join-constraint">join-constraint:</a></b>
<button id='x1421' onclick='hideorshow("x1421","x1422")'>显示</button></p>
 <blockquote id='x1422' style='display:none;'>
 <img alt="syntax diagram join-constraint" src="images/syntax/join-constraint.gif" />
</blockquote>
<p><b><a href="syntaxdiagrams.html#join-operator">join-operator:</a></b>
<button id='x1423' onclick='hideorshow("x1423","x1424")'>显示</button></p>
 <blockquote id='x1424' style='display:none;'>
 <img alt="syntax diagram join-operator" src="images/syntax/join-operator.gif" />
</blockquote>
</blockquote>
<p><b><a href="syntaxdiagrams.html#ordering-term">ordering-term:</a></b>
<button id='x1425' onclick='hideorshow("x1425","x1426")'>显示</button></p>
 <blockquote id='x1426' style='display:none;'>
 <img alt="syntax diagram ordering-term" src="images/syntax/ordering-term.gif" />
</blockquote>
<p><b><a href="syntaxdiagrams.html#result-column">result-column:</a></b>
<button id='x1427' onclick='hideorshow("x1427","x1428")'>显示</button></p>
 <blockquote id='x1428' style='display:none;'>
 <img alt="syntax diagram result-column" src="images/syntax/result-column.gif" />
</blockquote>
<p><b><a href="syntaxdiagrams.html#table-or-subquery">table-or-subquery:</a></b>
<button id='x1429' onclick='hideorshow("x1429","x1430")'>显示</button></p>
 <blockquote id='x1430' style='display:none;'>
 <img alt="syntax diagram table-or-subquery" src="images/syntax/table-or-subquery.gif" />
</blockquote>
</blockquote>
</blockquote>
</blockquote>


<p>UPDATE语句是用来修改<i>qualified-table-name</i>指定的数据库表中若干行中存储的一组数据子集的。
<br />An UPDATE statement is used to modify a subset of the values stored in 
zero or more rows of the database table identified by the 
<i>qualified-table-name</i> specified as part of the UPDATE statement.

<p>如果UPDATE语句不带WHERE子句，那么表中的所有行都会被这条UPDATE修改。否则，UPDATE只有WHERE子句表达式计算结果返回<a href="lang_expr.html#booleanexpr">布尔型true</a>的行才会受到影响。如果表中的所有行经过WHERE子句计算返回的都不是true，那么这就意味着UPDATE影响了零行。
<br />If the UPDATE statement does not have a WHERE clause, all rows in the
table are modified by the UPDATE. Otherwise, the UPDATE affects only those
rows for which the result of evaluating the WHERE clause expression as a 
<a href="lang_expr.html#booleanexpr">boolean expression is true</a>. It is not an error if the
WHERE clause does not evaluate to true for any row in the table - this just
means that the UPDATE statement affects zero rows.

<p>UPDATE对每行做什么修改是由跟在SET关键词后面的赋值描述列表决定的。赋值描述中等号左边是需要修改的列的名字，右边是一个表达式。在每个受影响的行中，指定的列被赋值为对应的表达式的计算结果。如果一个列名在赋值描述列表中出现了多次，那么除了最右边的以外都会被忽略。没有出现在赋值描述列表中的列不会被修改。赋值表达式中可能会引用这一行记录中其它要被修改的列，这种情况下，所有的复制表达式会在进行赋值之前全部计算完。
<br />The modifications made to each row affected by an UPDATE statement are
determined by the list of assignments following the SET keyword. Each
assignment specifies a column name to the left of the equals sign and a
scalar expression to the right. For each affected row, the named columns
are set to the values found by evaluating the corresponding scalar 
expressions. If a single column-name appears more than once in the list of
assignment expressions, all but the rightmost occurrence is ignored. Columns
that do not appear in the list of assignments are left unmodified. The scalar
expressions may refer to columns of the row being updated. In this case all
scalar expressions are evaluated before any assignments are made.

<p>冲突选项允许用户为本条UPDATE命令指定一个特殊的约束冲突解决算法。详细信息参见<a href="lang_conflict.html">ON CONFLICT</a>。
<br />The optional conflict-clause allows the user to nominate a specific
constraint conflict resolution algorithm to use during this one UPDATE command.
Refer to the section entitled <a href="lang_conflict.html">ON CONFLICT</a> for additional information.

<h3>CREATE TRIGGER中UPDATE语句的限制
<br />Restrictions on UPDATE Statements Within CREATE TRIGGER</h3>

<p>在<a href="lang_createtrigger.html">CREATE TRIGGER</a>语句内使用UPDATE会有下面这些附加的语法限制：
The following additional syntax restrictions apply to UPDATE statements that
occur within the body of a <a href="lang_createtrigger.html">CREATE TRIGGER</a> statement.  

<ul>
  <li><p>在一个触发器内的UPDATE语句是不允许限定<i>table-name</i>的。换句话说，触发器中的UPDATE不允许使用<i>database-name</i><b>.</b>表名前缀。触发器程序只允许更新同一个库上的表，除非触发器是在一个TEMP数据库上。触发器依附的表位于TEMP数据库里，那么搜索未加限定的表名逻辑与顶级UPDATE语句一致（首先搜索TEMP数据库，然后是主数据库，最后是其它的附加数据库）。
<br />The <i>table-name</i> specified as part of an UPDATE statement within
      a trigger body must be unqualified. In other words, the
      <i>database-name</i><b>.</b> prefix on the table name of the UPDATE is
      not allowed within triggers. Unless the table to which the trigger
      is attached is in the TEMP database, the table being updated by the
      trigger program must reside in the same database as it. If the table
      to which the trigger is attached is in the TEMP database, then the
      unqualified name of the table being updated is resolved in the same way
      as it is for a top-level statement (by searching first the TEMP database,
      then the main database, then any other databases in the order they were
      attached).

  <li><p>在触发器程序中的UPDATE语句不能使用INDEXED BY 和 NOT INDEXED。
<br />The INDEXED BY and NOT INDEXED clauses are not allowed on UPDATE
      statements within triggers.</p>

  <li><p>无论使用什么编译器参数，触发器程序中的UPDATE语句都是不支持LIMIT 和 ORDER BY子句的。
<br />The LIMIT and ORDER BY clauses for UPDATE are unsupported within
      triggers, regardless of the compilation options used to build SQLite.
</ul>

<h3>LIMIT 和 ORDER BY 子句选项
<br />Optional LIMIT and ORDER BY Clauses</h3>

<p>如果在编译SQLite时添加了<a href="compile.html#enable_update_delete_limit">SQLITE_ENABLE_UPDATE_DELETE_LIMIT</a>选项，那么UPDATE语句就可以支持如下的ORDER BY和LIMIT子句扩展选项。
<br />If SQLite is built with the <a href="compile.html#enable_update_delete_limit">SQLITE_ENABLE_UPDATE_DELETE_LIMIT</a>
compile-time option then the syntax of the UPDATE statement is extended
with optional ORDER BY and LIMIT clauses as follows:</p>

<p><b><a href="syntaxdiagrams.html#update-stmt-limited">update-stmt-limited:</a></b></p><blockquote>
 <img alt="syntax diagram update-stmt-limited" src="images/syntax/update-stmt-limited.gif"></img>
 </blockquote>


<p>如果UPDATE语句包含一个LIMIT子句，那么更新的最大行数会被限定为跟在LIMIT后的表达式的计算结果，表达式的结果会被转换为整数。如果结果为负值，那么就认为是“没有限制”。
<br />If an UPDATE statement has a LIMIT clause, the maximum number of rows that
will be updated is found by evaluating the accompanying expression and casting
it to an integer value. A negative value is interpreted as "no limit".

<p>如果LIMIT表达式的计算结果为非负数<i>N</i>，并且UPDATE语句包含了ORDER BY 子句，那么会首先将所有满足更新条件的行（不包含LIMIT限制）按照ORDER BY子句进行排序，然后更新前<i>N</i>行记录。如果UPDATE语句还包含OFFSET子句，那么跟随其后的表达式会同样被计算并转换为整数值，如果OFFSET表达式计算结果为非负数<i>M</i>，那么更新时最前面的<i>M</i>条记录会被忽略，然后更新其后的<i>N</i>行记录。
<br />If the LIMIT expression evaluates to non-negative value <i>N</i> and the
UPDATE statement has an ORDER BY clause, then all rows that would be updated in
the absence of the LIMIT clause are sorted according to the ORDER BY and the
first <i>N</i> updated. If the UPDATE statement also has an OFFSET clause,
then it is similarly evaluated and cast to an integer value. If the OFFSET
expression evaluates to a non-negative value <i>M</i>, then the first <i>M</i>
rows are skipped and the following <i>N</i> rows updated instead.

<p>如果UPDATE语句中没有ORDER BY子句，那么所有满足更新条件的行（不包含LIMIT限制）会按照随机顺序排列到一起，然后依照LIMIT和OFFSET子句来决定实际更新哪些记录。
<br />If the UPDATE statement has no ORDER BY clause, then all rows that
would be updated in the absence of the LIMIT clause are assembled in an
arbitrary order before applying the LIMIT and OFFSET clauses to determine 
which are actually updated.

<p>UPDATE中的ORDER BY子句只是用来决定哪些行记录符合LIMIT，而满足条件的行的实际更新顺序则不受ORDER BY的影响，而是随机顺序完成更新。
<br />The ORDER BY clause on an UPDATE statement is used only to determine which
rows fall within the LIMIT. The order in which rows are modified is arbitrary
and is not influenced by the ORDER BY clause.


